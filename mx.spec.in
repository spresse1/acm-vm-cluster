Name: mx
Version: @MX_MAJOR_VERSION@.@MX_MINOR_VERSION@.@MX_TEENY_VERSION@@MX_VERSION_SUFFIX@
Release: 1
License: Myricom
Summary: MX software for Myrinet
Group: Cluster software
#This is just wrong.  See http://www.rpm.org/max-rpm/s1-rpm-inside-tags.html
# for what this tag ACTUALLY does.
#Buildroot: @abs_builddir@/rpm-buildroot
Prefix: /usr/local
Source: http://www.myricom.com/pub/MX2G/mx2g_@MX_MAJOR_VERSION@.@MX_MINOR_VERSION@.@MX_TEENY_VERSION@.tar.gz

#%define _rpmdir .
#%define _rpmfilename %%{NAME}-%%{VERSION}-%%{RELEASE}.%%{ARCH}.rpm

%description
MX software for Myrinet

%prep
%setup
echo "BUILDDIR: $RPM_BUILD_DIR"

%build
./configure --prefix="$RPM_BUILDROOT_DIR"
make

%install
echo "beginning insall"
make DESTDIR="$RPM_BUILD_ROOT" install
rm "$RPM_BUILD_ROOT/lib"

%files
%defattr(-,root,root)
#"@prefix@/*/*"
#"@prefix@/productinfo"
"@prefix@/bin/*"
"@prefix@/include/*"
"@prefix@/lib64/*"
"@prefix@/sbin/*"
"@prefix@/productinfo/"

%post
/bin/grep -q @prefix@/lib32/ /etc/ld.so.conf || echo @prefix@/lib32/ >> /etc/ld.so.conf
/bin/grep -q @prefix@/lib64 /etc/ld.so.conf || echo @prefix@/lib64/ >> /etc/ld.so.conf
/sbin/ldconfig
if [ -n "`/sbin/lspci -d 14c1:`" ] ; then
  @prefix@/sbin/mx_local_install
   chkconfig --add mx || /bin/true
fi

%preun
chkconfig --del mx || /bin/true

